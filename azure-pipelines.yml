# Starter pipeline

trigger:
    branches:
      include:
        - main

pool:
  name: ec2-self-hosted

#variables:

#parameters:
#- name: envronment  
#  type: string  
#  default: dev
#  values:  
#  - dev
#  - stagging
#  - prod

stages:
- stage: CI
  displayName: CI stage
  jobs:
  - job: Lint
    displayName: Linting Backend
    steps:
    - checkout: self
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.9.22'
        addToPath: true
    - script: |
        python3.9 -m venv .venv
        source .venv/bin/activate
        pip install flake8
        flake8 src/feedback_backend/app.py
      displayName: 'Run Linting'

  - job: Test
    dependsOn: Lint
    displayName: Testing Backend
    steps:
    - checkout: self
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.9.22'
        addToPath: true
    - script: |
        python3.9 -m venv .venv
        source .venv/bin/activate
        pip install -r src/feedback_backend/requirements.txt
        pip install pytest
        pytest
      displayName: 'Run Unit Test'
      #workingDirectory: $(Build.SourcesDirectory)